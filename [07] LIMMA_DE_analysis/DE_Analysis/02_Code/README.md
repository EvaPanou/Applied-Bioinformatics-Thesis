# LIMMA Timeseries (Illumina microarray)

This pipeline finds differentially expressed genes (DEGs) in two ways:
  
1. **Conditional (A):** SLE vs Healthy at *each* timepoint  
2. **Temporal (B):** Within each condition, later timepoint vs earlier timepoint  
- Mode `adjacent`: compare T2-T1, T3-T2, â€¦  
- Mode `all`: compare every later TP to every earlier TP (TiSA-style)

It also:
- accounts for **repeated measures** (duplicateCorrelation with Subject),
- outputs **ComplexHeatmap** and **UpSet** visualizations,
- builds **non-redundant ML feature lists** and matrices.

## Inputs
- Expression (log2 microarray): `/mnt/data/08_df_no_low_genes.tsv`  
- first column = gene IDs; columns = sample IDs  
- Metadata: `/mnt/data/GSE108497_updated_metadata.tsv`  
- columns: `Sample`, `Condition` (`Healthy`/`SLE`), `Timepoint`, `Subject`

## Run
```bash
Rscript limma_deg_pipeline.R 
```
---

## ðŸ“Š Global Visualizations

| Path | Generated by | Method / Stats | Description |
| --- | --- | --- | --- |
| Heatmap_A_DEG_Union_FDR0.05.png | Step 7 â€“ plot_heatmap_union(); Step 8 â€“ plot_upset() | ComplexHeatmap (z-score per gene); UpSetR overlaps | ComplexHeatmap of DEG union (z-scored), columns: samples, rows: genes. |
| UpSet_A_DN_FDR0.05.png | Step 7 â€“ plot_heatmap_union(); Step 8 â€“ plot_upset() | ComplexHeatmap (z-score per gene); UpSetR overlaps | UpSet plot showing set intersections among DEG contrasts. |
| UpSet_A_UP_FDR0.05.png | Step 7 â€“ plot_heatmap_union(); Step 8 â€“ plot_upset() | ComplexHeatmap (z-score per gene); UpSetR overlaps | UpSet plot showing set intersections among DEG contrasts. |
| UpSet_B_DN_FDR0.05.png | Step 7 â€“ plot_heatmap_union(); Step 8 â€“ plot_upset() | ComplexHeatmap (z-score per gene); UpSetR overlaps | UpSet plot showing set intersections among DEG contrasts. |
| UpSet_B_UP_FDR0.05.png | Step 7 â€“ plot_heatmap_union(); Step 8 â€“ plot_upset() | ComplexHeatmap (z-score per gene); UpSetR overlaps | UpSet plot showing set intersections among DEG contrasts. |

## ðŸ”— Output Subfolders

- A_SLE_vs_Healthy/
- B_Temporal_adjacent/
- Enrichment/
- DE_Genes/
- Visualization/

## ðŸ§ª Methods & Stats (Summary)

- **Differential expression**: limma with `duplicateCorrelation` (blocked by Subject), empirical Bayes moderation; BH FDR correction; logFC thresholds Â±1 for up/down lists.
- **Temporal contrasts**: adjacent timepoints within each condition (`later - earlier`).
- **Heatmap**: union of DEGs; z-scored per gene; column order SLEâ†’Healthy, timepoints leftâ†’right; row clusters via k-means/ward.D2.
- **Enrichment**: clusterProfiler (GO/KEGG/Reactome) with BH correction; dotplots for top categories.
- **ML features**: union of DEGs; top 5% row variance filter; export log2 and Z-scored matrices.
- **Global F-test**: limma interaction model for ConditionÃ—Time (ANOVA-style), ranked by F-statistic with BH adjustment.

## ðŸ§¬ Reproducibility

- **Script**: `limma_deg_pipeline.R`
- **R version**: R 4.5.2
- **Bioconductor core**: limma, ComplexHeatmap, UpSetR, clusterProfiler, org.Hs.eg.db, ReactomePA, enrichplot.
