# LIMMA Timecourse (Illumina microarray)

This pipeline finds differentially expressed genes (DEGs) in two ways:
  
1. **Conditional (A):** SLE vs Healthy at *each* timepoint  
2. **Temporal (B):** Within each condition, later timepoint vs earlier timepoint  
- Mode `adjacent`: compare T2-T1, T3-T2, â€¦  
- Mode `all`: compare every later TP to every earlier TP (TiSA-style)

It also:
- accounts for **repeated measures** (duplicateCorrelation with Subject),
- outputs **ComplexHeatmap** and **UpSet** visualizations,
- builds **non-redundant ML feature lists** and matrices.

## Inputs
- Expression (log2 microarray): `/mnt/data/08_df_no_low_genes.tsv`  
- first column = gene IDs; columns = sample IDs  
- Metadata: `/mnt/data/GSE108497_updated_metadata.tsv`  
- columns: `Sample`, `Condition` (`Healthy`/`SLE`), `Timepoint`, `Subject`

## Methods & Stats (Summary)

- **Differential expression**: limma with `duplicateCorrelation` (blocked by Subject), empirical Bayes moderation; BH FDR correction; logFC thresholds Â±1 for up/down lists.
- **Temporal contrasts**: adjacent timepoints within each condition (`later - earlier`).
- **Heatmap**: union of DEGs; z-scored per gene; column order SLEâ†’Healthy, timepoints leftâ†’right; row clusters via k-means/ward.D2.
- **Enrichment**: clusterProfiler (GO/KEGG/Reactome) with BH correction; dotplots for top categories.
- **ML features**: union of DEGs; top 5% row variance filter; export log2 and Z-scored matrices.
- **Global F-test**: limma interaction model for ConditionÃ—Time (ANOVA-style), ranked by F-statistic with BH adjustment.

## Run
```bash
Rscript limma_deg_pipeline.R
```

## 5 Output Subfolder

- **A_SLE_vs_Healthy:** This folder contains limma results comparing **SLE vs Healthy** within each timepoint. It includes upregulated and downregulated gene lists based on two FDR values 0.01 and 0.05 (based on the [06] LitReview/ Conlcusions)
- **B_Temporal_adjacent**: This folder contains tsv files that list **genes that are differentially expressed** between adjacent pregnancy stages, **separately for SLE and Healthy** women. The thresholds are strict  (FDR<0.01, |logFC|>1), so only the most robust changes appear.
- **Enrichment**: This folder contains enrichment graphs and plots generated during the longitudinal DEG and enrichment analysis pipeline, and summarizes the biological interpretation, corresponding to 
the annotated gene clusters obtained from the ComplexHeatmap
- **DE_Genes**: This folder contains the DEG lists before, and after highly variant genes were calculated. It also contains feature tables assembled from **DEG union** (total unique DEGs accross timepoints and conditions) and **high-variance** gene lists. Matrices are provided in **log2 scale** and **Z-scored** variants (per gene).
- **Visualization**: This folder contains the plots generated by the R script. Heatmaps are created with **ComplexHeatmap** (z-score per gene); UpSet plots use **UpSetR**.

## ðŸ“‚ Root-level Outputs

| Path | Generated by | Method / Stats | Description |
| --- | --- | --- | --- |
| Downregulated_cluster_genes.tsv | Step 7 (clusters) and Step 10 (global model) | limma ANOVA-style interaction (F-test); k-means labeling on z-scored expression | Genes from heatmap cluster labeled 'Down-regulated' (k-means derived). |
| Global_Time_by_Condition_Ftest.tsv | Step 7 (clusters) and Step 10 (global model) | limma ANOVA-style interaction (F-test); k-means labeling on z-scored expression | Global F-test across ConditionÃ—Time interaction terms (limma). |
| Heatmap_GeneClusters_Annotated.tsv | Step 7 (clusters) and Step 10 (global model) | limma ANOVA-style interaction (F-test); k-means labeling on z-scored expression | Per-gene mapping to heatmap row-cluster labels (Up/Mixed/Down). |
---

**Table: Global_Time_by_Condition_Ftest.tsv**  

This table contains the results of a genome-wide F-test for the **Condition Ã— Time** interaction term. The test identifies genes whose expression trajectories across gestation differ significantly between SLE and healthy groups. High-ranking genes in this list include multiple **interferon-regulated** and **neutrophil degranulation-associated** genes, mirroring the clusters identified in the heatmaps. This analysis extends pairwise observations by confirming that the **temporal shape** of expression changeâ€”not merely the mean differenceâ€”is altered in SLE pregnancies. Such trajectory-level divergence underscores the chronic and fluctuating nature of immune activation in SLE, even under the immune-tolerant conditions of gestation.


**Table: Heatmap_GeneClusters_Annotated.tsv**  
**Table: Downregulated_cluster_genes.tsv**  

The annotated cluster table maps each gene from the heatmap to its corresponding expression pattern group. Notably, the **Down-regulated genes** subset includes immunomodulatory and metabolic regulators such as *CD79A*, *PTPRC*, and *BCL2A1*, implicating transient suppression of adaptive immunity and lymphocyte differentiation in both groups, but more strongly in SLE. This may represent a compensatory mechanism attempting to counterbalance overactive innate immunity. However, consistent with recent findings, this adaptive repression appears insufficient to restore immune homeostasis.  

The maintenance of such downregulated networks through gestation and postpartum suggests **a persistent skewing of immune equilibrium**, wherein upregulated innate pathways are only partially offset by diminished adaptive responses, potentially contributing to heightened risk of flare or placental dysfunction.

